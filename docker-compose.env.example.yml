version: '3.8'

services:
  filesystem-exporter:
    image: ghcr.io/d0ugal/filesystem-exporter:latest
    container_name: filesystem-exporter
    ports:
      - "8080:8080"
    volumes:
      # Mount the host filesystem (adjust paths as needed)
      - /:/host:ro
    environment:
      # Force environment variable configuration mode
      - FILESYSTEM_EXPORTER_CONFIG_FROM_ENV=true

      # Server configuration
      - FILESYSTEM_EXPORTER_SERVER_HOST=0.0.0.0
      - FILESYSTEM_EXPORTER_SERVER_PORT=8080

      # Logging configuration
      - FILESYSTEM_EXPORTER_LOG_LEVEL=info
      - FILESYSTEM_EXPORTER_LOG_FORMAT=json

      # Metrics configuration
      - FILESYSTEM_EXPORTER_METRICS_DEFAULT_INTERVAL=5m

      # Filesystems configuration
      # Format: "name:mount:device[:interval]"
      - FILESYSTEM_EXPORTER_FILESYSTEMS=root:/host:sda1:1m,data:/host/data:sdb1:2m

      # Directories configuration
      # Format: "name:path:levels[:interval]"
      - FILESYSTEM_EXPORTER_DIRECTORIES=home:/host/home:1:10m,logs:/host/var/log:0:5m,apps:/host/opt/apps:2:30m

      # Timezone
      - TZ=UTC
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 128M

# Example with minimal configuration:
# services:
#   filesystem-exporter:
#     image: ghcr.io/d0ugal/filesystem-exporter:latest
#     container_name: filesystem-exporter
#     ports:
#       - "8080:8080"
#     volumes:
#       - /:/host:ro
#     environment:
#       - FILESYSTEM_EXPORTER_CONFIG_FROM_ENV=true
#       - FILESYSTEM_EXPORTER_FILESYSTEMS=root:/host:sda1
#       - FILESYSTEM_EXPORTER_DIRECTORIES=home:/host/home:1
#     restart: unless-stopped

# Synology NAS Example with Environment Variables:
# services:
#   filesystem-exporter:
#     image: ghcr.io/d0ugal/filesystem-exporter:latest
#     container_name: filesystem-exporter
#     ports:
#       - "8080:8080"
#     volumes:
#       - /volume1:/volume1:ro
#       - /volumeUSB1:/volumeUSB1:ro
#     environment:
#       - FILESYSTEM_EXPORTER_CONFIG_FROM_ENV=true
#       - FILESYSTEM_EXPORTER_FILESYSTEMS=volume1:/volume1:sda1:1m,usb1:/volumeUSB1/usbshare:usb1p1:2m
#       - FILESYSTEM_EXPORTER_DIRECTORIES=nas:/volume1/nas:1:10m,media:/volume1/nas/Media:2:30m,docker:/volume1/docker:0:5m
#       - TZ=Europe/London
#     restart: unless-stopped

# Docker Host Monitoring Example with Environment Variables:
# services:
#   filesystem-exporter:
#     image: ghcr.io/d0ugal/filesystem-exporter:latest
#     container_name: filesystem-exporter
#     ports:
#       - "8080:8080"
#     volumes:
#       - /var/lib/docker:/host/var/lib/docker:ro
#       - /var/log:/host/var/log:ro
#     environment:
#       - FILESYSTEM_EXPORTER_CONFIG_FROM_ENV=true
#       - FILESYSTEM_EXPORTER_FILESYSTEMS=host:/host:sda1:1m
#       - FILESYSTEM_EXPORTER_DIRECTORIES=containers:/host/var/lib/docker/containers:1:5m,volumes:/host/var/lib/docker/volumes:1:5m,logs:/host/var/log:0:2m
#       - TZ=UTC
#     restart: unless-stopped
